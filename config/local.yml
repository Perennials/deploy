credentials:
  github:
    Perennials:
      token: xxxxxxxxxxx
      username: perennials-bot
      password: xxxxxxxxxx

vars:
  env: dev

projects:
  
  ####
  bonotel:
    extends: supplier  

  ####
  ws2:
    repo:
      remote: github/Perennials/providersdk-ws
      local: /apps/{project}/{branch}

    docker:
      image: 'docker.perennial.int/{project}:{branch.tag}'

  ####
  supplier:
    template: true

    vars:
      local: /apps/supplier/{project}/{branch}

    ################### this should go in include only for dev
    #include: !iffile config/{project}.{env}.yml
    repo:
      remote: github/Perennials/supplier-{project}
      local: '{project.local}'
      vars:
        sdk-version: !!js/function >
          function ( global, require, vars ) {
            try {
              return require( 'fs' )
                .readFileSync( vars.render( '{project.local}/supplier.php' ), 'utf8' )
                .match( /providerkit-php\/([^\/]+)\/init.php/ )[ 1 ];
            }
            catch ( e ) {
              // global.console.error( e );
              // global.console.log( vars )
              return 'master';
            }
          }
      submodules:
        github/Perennials/providerkit-php#{repo.sdk-version}: '{project.local}/lib/providerkit-php'

    docker:
      image: 'docker.perennial.int/{project}:{branch.tag}'
      file: '{project.local}/docker'
    ###################

    rocker-compose:
      file: '{project.local}/docker'
      vars:
        env: '{env}'
        name: '{project}'
        version: '{branch}'

    